<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="styles/mycss2.css">
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <title>КАТАЛОГ</title>
</head>

<body>


    <header>

        <nav class="navbar navbar-expand-lg bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="proj1.html"><img src="picture/СТМ ЛОГО.jpg" alt=""></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">


                        <li class="nav-item">
                            <a class="nav-link " href="proj1.html">Главная</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link " href="body1 О нас.html">О НАС</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="body2 Каталог.html">КАТАЛОГ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="body3 Доставка.html">ДОСТАВКА</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="body4 Продукция СТМ.html">ПРОДУКЦИЯ СТМ</a>
                        </li>
                        <a class="nav-link" href="body5 Контакты.html">КОНТАКТЫ</a>
                    </ul>
                    <span class="navbar-text">
                        8 (8632) 322-38-88
                    </span>
                </div>
            </div>
        </nav>



    </header>

    <label for="categoryFilter">Категория:</label>
    <select id="categoryFilter" onchange="filterTable()">
        <option value="all">Все категории</option>
        <option value="Резьбовые фитинги">Резьбовые фитинги</option>
        <option value="Полипропиленовые трубы">Полипропиленовые трубы</option>
        <option value="Канализационные трубы и фитинги">Канализационные трубы и фитинги</option>
        <option value="Пнд трубы и фитинги">Пнд трубы и фитинги</option>
        <option value="Металлополимерные трубы и фитинги">Металлополимерные трубы и фитинги</option>
        <option value="Смесители и комплектующие">Смесители и комплектующие</option>
    </select>

    <label for="codeInput">Код:</label>
    <input type="text" id="codeInput" oninput="filterTable()" placeholder="Введите код товара">

    <label for="nameInput">Наименование:</label>
    <input type="text" id="nameInput" oninput="filterTable()" placeholder="Введите наименование товара">

    <br>
    <button onclick="exportSelectedToExcel()">Экспорт выбранных товаров</button>
    <button onclick="clearSelection()">Сбросить выбор</button>
    <div id="selectedCount">Выбрано товаров: 0</div>
    <input type="file" id="priceFileInput" accept=".xlsx, .xls" onchange="loadPricesFromExcel()" style="display:none">
    <button onclick="document.getElementById('priceFileInput').click()">Загрузить цены из Excel</button>



    <table id="productTable">
        <thead>
            <tr>
                <th><input type="checkbox" id="selectAll" onclick="toggleSelectAll(this)"></th>
                <th>Изображение</th>
                <th>Код</th>
                <th>Наименование</th>
                <th>Категория</th>
                <th>Характеристики</th>
                <th>Цена</th>
            </tr>
        </thead>
        <tbody>
            <tr data-category="Смесители и комплектующие" data-id="001">
                <td><input type="checkbox" class="selectRow" onchange="updateSelectedCount()"></td>
                <td><img src="https://ledeme-russia.ru/img/catphotos/4/smesitel-dlya-kukhni-ledeme-l4201010.jpg"
                        data-url="https://ledeme-russia.ru/img/catphotos/4/smesitel-dlya-kukhni-ledeme-l4201010.jpg">
                </td>
                <td>11</td>
                <td>Смеситель для кухни Ledeme H01 L4201</td>
                <td>Смесители и комплектующие</td>
                <td>Цвет: Черный; Память: 128 ГБ</td>
                <td></td>
            </tr>

            <tr data-category="Смесители и комплектующие" data-id="0011">
                <td><input type="checkbox" class="selectRow" onchange="updateSelectedCount()"></td>
                <td><img src="https://ledeme-russia.ru/img/catphotos/4/smesitel-dlya-kukhni-ledeme-l5901a001.jpg"
                        data-url="https://ledeme-russia.ru/img/catphotos/4/smesitel-dlya-kukhni-ledeme-l5901a001.jpg">
                </td>
                <td>14</td>
                <td>Смеситель для кухни Ledeme H01A L5901A</td>
                <td>Смесители и комплектующие</td>
                <td>Цвет: Черный; Память: 128 ГБ</td>
                <td></td>
            </tr>

            <tr data-category="Смесители и комплектующие" data-id="0012">
                <td><input type="checkbox" class="selectRow" onchange="updateSelectedCount()"></td>
                <td><img src="https://ledeme-russia.ru/img/catphotos/4/smesitel-dlya-dusha-ledeme-l2004010.jpg"
                        data-url="https://ledeme-russia.ru/img/catphotos/4/smesitel-dlya-dusha-ledeme-l2004010.jpg">
                </td>
                <td>15</td>
                <td>Смеситель для душа Ledeme H04 L2004</td>
                <td>Смесители и комплектующие</td>
                <td>Цвет: Черный; Память: 128 ГБ</td>
                <td></td>
            </tr>

            <tr data-category="Смесители и комплектующие" data-id="0013">
                <td><input type="checkbox" class="selectRow" onchange="updateSelectedCount()"></td>
                <td><img src="https://ledeme-russia.ru/img/catphotos/4/smesitel-ledeme-h04a-l1004a1.jpg"
                        data-url="https://ledeme-russia.ru/img/catphotos/4/smesitel-ledeme-h04a-l1004a1.jpg">
                </td>
                <td>16</td>
                <td>Смеситель для раковины Ledeme H04A L1004A</td>
                <td>Смесители и комплектующие</td>
                <td>Цвет: Черный; Память: 128 ГБ</td>
                <td></td>
            </tr>




            <tr data-category="Одежда" data-id="002">
                <td><input type="checkbox" class="selectRow" onchange="updateSelectedCount()"></td>
                <td><img src="https://drive.google.com/file/d/1h8sOtAaZUQaaR9D0nhyzvVT5ozOxn5jQ/view?usp=sharing"
                        data-url="https://drive.google.com/file/d/1h8sOtAaZUQaaR9D0nhyzvVT5ozOxn5jQ/view?usp=sharing"></td>
                <td>12</td>
                <td>Куртка</td>
                <td>Одежда</td>
                <td>Размер: L; Цвет: Синий</td>
                <td></td>
            </tr>
            <tr data-category="Продукты" data-id="003">
                <td><input type="checkbox" class="selectRow" onchange="updateSelectedCount()"></td>
                <td><img src="https://via.placeholder.com/80?text=Молоко"
                        data-url="https://via.placeholder.com/80?text=Молоко"></td>
                <td>13</td>
                <td>Молоко</td>
                <td>Продукты</td>
                <td>Жирность: 3.2%; Объём: 1л</td>
                <td></td>
            </tr>
        </tbody>
    </table>

    <script>
        const selectedItems = new Set();

        function filterTable() {
            const categoryFilter = document.getElementById("categoryFilter").value.toLowerCase();
            const codeFilter = document.getElementById("codeInput").value.toLowerCase();
            const nameFilter = document.getElementById("nameInput").value.toLowerCase();

            const rows = document.querySelectorAll("#productTable tbody tr");

            rows.forEach(row => {
                const category = row.getAttribute("data-category").toLowerCase();
                const code = row.cells[2].textContent.toLowerCase();
                const name = row.cells[3].textContent.toLowerCase();
                const id = row.getAttribute("data-id");

                const matchesCategory = categoryFilter === "all" || category === categoryFilter;
                const matchesCode = code.includes(codeFilter);
                const matchesName = name.includes(nameFilter);

                row.style.display = (matchesCategory && matchesCode && matchesName) ? "" : "none";

                // Восстановить выбор после фильтрации
                const checkbox = row.querySelector(".selectRow");
                checkbox.checked = selectedItems.has(id);
            });

            updateSelectedCount();
        }

        function toggleSelectAll(source) {
            const checkboxes = document.querySelectorAll("#productTable tbody tr");
            checkboxes.forEach(row => {
                if (row.style.display !== "none") {
                    const checkbox = row.querySelector(".selectRow");
                    const id = row.getAttribute("data-id");
                    checkbox.checked = source.checked;
                    if (source.checked) {
                        selectedItems.add(id);
                    } else {
                        selectedItems.delete(id);
                    }
                }
            });
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const rows = document.querySelectorAll("#productTable tbody tr");
            rows.forEach(row => {
                const checkbox = row.querySelector(".selectRow");
                const id = row.getAttribute("data-id");

                if (checkbox.checked) {
                    selectedItems.add(id);
                    row.classList.add("selected-row");
                } else {
                    selectedItems.delete(id);
                    row.classList.remove("selected-row");
                }
            });

            document.getElementById("selectedCount").innerText =
                `Выбрано товаров: ${selectedItems.size}`;

            // Синхронизируем состояние чекбокса "Выбрать все"
            const visibleCheckboxes = Array.from(document.querySelectorAll("#productTable tbody tr"))
                .filter(row => row.style.display !== "none")
                .map(row => row.querySelector(".selectRow"));

            const allChecked = visibleCheckboxes.length > 0 && visibleCheckboxes.every(cb => cb.checked);
            document.getElementById("selectAll").checked = allChecked;
        }
        function exportSelectedToExcel() {
            const data = [["Код", "Наименование", "Категория", "Характеристики", "Цена", "Изображение (ссылка)"]];
            const rows = document.querySelectorAll("#productTable tbody tr");

            rows.forEach(row => {
                const id = row.getAttribute("data-id");
                if (selectedItems.has(id)) {
                    const imageUrl = row.querySelector("img").getAttribute("data-url");
                    const code = row.cells[2].textContent.trim();
                    const name = row.cells[3].textContent.trim();
                    const category = row.cells[4].textContent.trim();
                    const specs = row.cells[5].textContent.trim();
                    const price = row.cells[6].textContent.trim();

                    data.push([code, name, category, specs, price, imageUrl]);
                }
            });

            if (data.length === 1) {
                alert("Выберите хотя бы один товар для экспорта.");
                return;
            }

            const worksheet = XLSX.utils.aoa_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Выбранные товары");
            XLSX.writeFile(workbook, "выбранные_товары.xlsx");
        }


        function clearSelection() {
            selectedItems.clear();

            const rows = document.querySelectorAll("#productTable tbody tr");
            rows.forEach(row => {
                const checkbox = row.querySelector(".selectRow");
                checkbox.checked = false;
                row.classList.remove("selected-row");
            });

            document.getElementById("selectAll").checked = false;
            updateSelectedCount();
        }

        function loadPricesFromExcel() {
            const input = document.getElementById("priceFileInput");
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: "array" });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const rows = XLSX.utils.sheet_to_json(sheet);

                // Создаем словарь цен: { код: цена }
                const priceMap = {};
                rows.forEach(row => {
                    if (row["Код"] && row["Цена"]) {
                        priceMap[row["Код"].toString().trim()] = row["Цена"].toString().trim();
                    }
                });

                // Обновляем таблицу
                let updatedCount = 0;
                const tableRows = document.querySelectorAll("#productTable tbody tr");
                tableRows.forEach(row => {
                    const code = row.cells[2].textContent.trim();
                    if (priceMap[code]) {
                        row.cells[6].textContent = priceMap[code];
                        updatedCount++;
                    }
                });

                alert(`Цены обновлены для ${updatedCount} товаров.`);
            };
            reader.readAsArrayBuffer(file);
        }

    </script>

</body>

</html>









<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous">
    </script>
</body>

</html>